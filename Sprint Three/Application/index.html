<!DOCTYPE html>
<!--
Team: Team Bare Maximum
Members: Reece Pieri, Rico Imbang, Say Hon Lee
Date: 05/11/2020

A teams based RAD project to develop/modify/amend/review a Movie Database Application to suit the specific requirements as outlined by the client.
-->

<html lang="en">
    <head>
        <title>Project</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="./css/tableheaders.css">
        <link rel="stylesheet" href="./css/stylesheet1.css">
        <link rel="stylesheet" href="./css/heading.css">
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Syncopate"/>
        <script src="./bootstrap/js/jquery.min.js"></script>
        <script src="./bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="./js/sorting.js"></script>
        <script type="text/javascript" src="./js/subscription.js"></script>
        <script type="text/javascript" src="./js/ratings.js"></script>
        <script type="text/javascript" src="./js/topten.js"></script>
        <script type="text/javascript" src="./js/indexload.js"></script>
    </head>

    <body class="bg-dark">
        
        <!-- Heading -->
        <div class="container-fluid">

            <!-- Title -->
            <div class="row justify-content-center">
                <div id="heading">
                    <span id="star1">&#9733</span>
                    <span id="star2">&#9733</span>
                    <span id="star3">&#9733</span>
                    <span id="pagetitle">ACME Movie DB</span>
                    <span id="star3">&#9733</span>
                    <span id="star2">&#9733</span>
                    <span id="star1">&#9733</span>
                </div>
            </div>

            <!-- Caption -->
            <div class="row justify-content-center">
                <span id="caption">The worlds most comprehensive online movie database!</span>
            </div>
            <div class="row justify-content-center">
                <span id="caption">Brought to you by ACME Entertainment Pty Ltd.</span>
            </div>
            <br>

            <!-- Subscribe button -->
            <div class="row justify-content-center">
                <div class="col text-center">
                    <button type="button" class="btn btn-outline-dark bg-warning subscribe" data-toggle="modal" data-target="#modalSubscribe">Subscribe to Newsletter</button>
                </div>
            </div>
        </div>

        <!-- Subscribe Modal -->
        <div class="container-fluid">
            <div class="modal hide fade" id="modalSubscribe" role="dialog">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="col-12">
                        <div class="modal-content bg-dark border-danger">
                            <div class="modal-header justify-content-center">
                                <h4 class="modal-title text-light" id="">Subscribe</h4>
                            </div>
                            <form id="subscribe" onsubmit="event.preventDefault(); SubscribeRequest()" method="POST">
                                <div class="modal-body">
                                    <div class="container">
                                        <div class="form-group row">
                                            <label for="subscribeFirstName" class="col-sm-4 col-form-label">First Name:</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="subscribeFirstName" placeholder="Enter first name" required>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="subscribeLastName" class="col-sm-4 col-form-label">Last Name:</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="subscribeLastName" placeholder="Enter last name" required>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="subscribeEmail" class="col-sm-4 col-form-label">Email:</label>
                                            <div class="col-sm-8">
                                                <input type="email" class="form-control" id="subscribeEmail" placeholder="Enter email" required>
                                            </div>
                                        </div>
                                        
                                        <label class="text-center d-block">Subscribe to:</label>
                                        
                                        <div class="form-group row">
                                            <div class="col-md-4"></div>
                                            <div class="col-md-6">
                                                <div class="form-check row">
                                                    <input class="form-check-input" type="checkbox" checked="checked" id="subscribeNewsletter">
                                                    <label class="form-check-label" for="subscribeNewsletter">Newsletter (monthly)</label>
                                                </div>
                                                <div class="form-check row">
                                                    <input class="form-check-input" type="checkbox" checked="checked" id="subscribeBreakingNews">
                                                    <label class="form-check-label" for="subscribeBreakingNews">Breaking News</label>
                                                </div>
                                            </div>
                                            <div class="col-md-2"></div>
                                        </div>
                                    </div>

                                    <div class="container-fluid">
                                        <!-- Error alert -->
                                        <div class="row justify-content-center">
                                            <div class="alert" id="subscribeAlert" role="alert" style="display: inline;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer justify-content-between">
                                    <button type="button" class="btn btn-outline-danger" data-toggle="modal" data-target="#modalUnsubscribe" style="padding: 3px;">Unsubscribe</button>
                                    <div>
                                        <button type="button" class="btn btn-outline-light bg-dark modalCloseButton" data-modalid="modalSubscribe">Cancel</button>
                                        <button type="submit" class="btn btn-outline-light" id="subscribeSubmit">Subscribe</button>
                                    </div>
                                </div>
                            </form>
                            
                            <!-- Unsubscribe Modal -->
                            <div class="modal hide fade" id="modalUnsubscribe" role="dialog">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content bg-dark border-danger col-sm-10 offset-sm-1">
                                        <div class="modal-header text-center d-block">
                                            <h4 class="modal-title text-light" id="">Unsubscribe</h4>
                                        </div>
                                        <form id="unsubscribe" onsubmit="event.preventDefault(); UnsubscribeRequest()" method="POST">
                                            <div class="modal-body">
                                                <div class="form-group row">
                                                    <label for="unsubscribeEmail" class="col-sm-3 col-form-label">Email:</label>
                                                    <div class="col-sm-9">
                                                        <input type="email" class="form-control" id="unsubscribeEmail" placeholder="Enter email" required>
                                                    </div>
                                                </div>

                                                <!-- Error alert -->
                                                <div class="row justify-content-center">
                                                    <div class="alert" id="unsubscribeAlert" role="alert" style="display: inline;"></div>
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-outline-light bg-dark modalCloseButton" data-modalid="modalUnsubscribe">Cancel</button>
                                                <button type="submit" class="btn btn-outline-light" id="unsubscribeSubmit">Unsubscribe</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>

        <!-- Search form-->
        <div class="container-fluid">
            <div class=" col-sm-auto">
                <div class="row justify-content-center border-top border-bottom border-light">
                    <form id="searchDB" style="width: 300px;" onsubmit="event.preventDefault(); SearchDatabase()" method="POST">

                        <!-- Search Database button -->
                        <div class="container">
                            <div class="form-group row justify-content-center">
                                <button class="btn btn-outline-light" style="margin-top: 15px; width: 270px;" type="button" data-toggle="collapse" data-target="#searchfilter">Search Database</button>
                            </div>
                        </div>

                        <!-- Search filters-->
                        <div class="container collapse" id="searchfilter">
                            <!-- Title search -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <label for="title">Title</label>
                                    <input type="text" class="form-control" id="title" placeholder="Enter title" autocomplete="off">
                                </div>
                            </div>

                            <!-- Genre search -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <label for="genre">Genre</label><br>
                                    <select class="custom-select form-control" id="genre">
                                        <option selected></option>
                                    </select>
                                </div>
                            </div>

                            <!-- Rating search -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <label for="rating">Rating</label><br>
                                    <select class="custom-select form-control" id="rating">
                                        <option selected></option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Year search -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <label for="year">Year</label><br>
                                    <select class="custom-select form-control" id="year">
                                        <option selected></option>
                                    </select>
                                </div>
                            </div>
                        
                            <!-- Search button -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <button class="btn btn-outline-light form-control" type="submit" data-toggle="collapse" data-target="#searchfilter">Go</button>
                                </div>
                            </div>

                            <!-- Most searched movies -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <button class="btn btn-outline-light form-control" type="button" type="submit" data-toggle="collapse" data-target="#searchfilter" onclick="GetTopTenData('SearchCount')">Top 10 Most Searched</button>
                                </div>
                            </div>

                            <!-- Highest rated movies -->
                            <div class="container">
                                <div class="form-group row justify-content-center">
                                    <button class="btn btn-outline-light form-control" type="button" type="submit" data-toggle="collapse" data-target="#searchfilter" onclick="GetTopTenData('AverageScore')">Top 10 Highest Rated</button>
                                </div>
                            </div>
                        </div>
                    </form> 
                </div>    
            </div>
        </div>

        <br>
        
        <!-- Results -->
        <div class="container">

            <!-- Top ten movies graph -->
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div id="graph" style="display: none;">
                        <img class="graphoutput" style="width: 100vw; max-width: 800px;">
                    </div>
                </div>
            </div>

            <!-- Table results -->
            <div class="container-fluid col-auto" id="resultsTable" style="display: none;">
                <div class="row">
                    <table class="table table-hover table-dark table-sm" id="bootstrap-override">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col"><a class="table_header" id="SortByTitle" href="" onclick='event.preventDefault(); SortTable("Title")'>Title</a></th>
                                <th scope="col"><a class="table_header" id="SortByStudio" href="" onclick='event.preventDefault(); SortTable("Studio")'>Studio</a></th>
                                <th scope="col"><a class="table_header" id="SortByPrice" href="" onclick='event.preventDefault(); SortTable("Price")'>Price</a></th>
                                <th scope="col"><a class="table_header" id="SortByRating" href="" onclick='event.preventDefault(); SortTable("Rating")'>Rating</a></th>
                                <th scope="col"><a class="table_header" id="SortByYear" href="" onclick='event.preventDefault(); SortTable("Year")'>Year</a></th>
                                <th scope="col"><a class="table_header" id="SortByGenre" href="" onclick='event.preventDefault(); SortTable("Genre")'>Genre</a></th>
                                <th scope="col"><a class="table_header" id="SortByScore" href="" onclick='event.preventDefault(); SortTable("Score")'>Score</a></th>
                                <th scope="col"><a class="table_header" id="RateMovie"></a></th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Error alert -->
            <div class="alert alert-danger" id="errorMessage" role="alert" style="display: none;"></div>

            <br>
            <br>
            <br>

            <!-- Rate Movie Modal -->
            <div class="modal hide fade" id="modalRateMovie" role="dialog">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content bg-dark border-danger col-sm-12">
                        <div class="modal-header text-center d-block">
                            <h4 class="modal-title text-light" id="">Rate Movie</h4>
                        </div>

                        <div class="modal-body">
                            <div class="container">
                                <div class="row">
                                    <div class="col rating-1star-div">
                                        <button type="button" class="btn rating-star" id="1star" value="1" name="">&#9733</button>
                                    </div>
                                    <div class="col rating-2star-div">
                                        <button type="button" class="btn rating-star" id="2star" value="2" name="">&#9733</button>
                                    </div>
                                    <div class="col rating-3star-div">
                                        <button type="button" class="btn rating-star" id="3star" value="3" name="">&#9733</button>
                                    </div>
                                    <div class="col rating-4star-div">
                                        <button type="button" class="btn rating-star" id="4star" value="4" name="">&#9733</button>
                                    </div>
                                    <div class="col rating-5star-div">
                                        <button type="button" class="btn rating-star" id="5star" value="5" name="">&#9733</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <div class="container">
                                <div class="row justify-content-center">
                                    <!-- Error alert -->
                                    <div class="alert" id="ratingAlert" role="alert" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Go to Top button -->
            <div class="container">
                <div class="row justify-content-center">
                    <a class="btn btn-danger fixed-bottom" id="back-to-top" style="display: none;" type="button" href="#">^</button>
                </div>
            </div>
        </div>

		<script>
			var movies = []
            var sortOrder = 0;
            var sortedBy = null;
            var search = false;
            var autoRefreshId;
            
            // Search database
            function SearchDatabase() {
                clearInterval(autoRefreshId);
                search = true;
                document.getElementById("graph").style.display = "none";

                var xhttp;
                var title = document.getElementById("title").value;
                var genre = document.getElementById("genre").value;
                var rating = document.getElementById("rating").value;
                var year = document.getElementById("year").value;

				if (window.XMLHttpRequest) {
					xhttp = new XMLHttpRequest(); // For most browsers
				} else {
					xhttp = new ActiveXObject("Microsoft.XMLHTTP"); // For IE
				}

				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
                        
                        if (this.responseText.length != 0) {
                            document.getElementById("errorMessage").style.display = "none";
                            var results = this.responseText.replace(/\\/g, "")
                                .replace(/ "/g, " \'").replace(/" /g, "\' ")
                            movies = JSON.parse(results);

                            // Sort movies
                            if (sortedBy == null) {
                                SortMovies("Title");
                            } else {
                                SortMovies(sortedBy)
                            }

                            UpdateTable();

                        } else {
                            ClearTable();
                            document.getElementById("errorMessage").innerHTML = "No movies found.";
                            document.getElementById("errorMessage").style.display = "inline";
                        }
					}
				};
				xhttp.open("POST", "./php/Index/search_db.php", true);
				xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				xhttp.send("title=" + title + "&genre=" + genre + "&rating=" + rating + "&year=" + year);
            }

            // Populate table with database query results
            function UpdateTable() {
                var tableBody = document.getElementById("tableBody");
                tableBody.innerHTML = "";
                var count = 0;
                
                // Create new table row element for each user
                for (movie in movies) {
                    count++;
                    var row = document.createElement('tr');
                    row.innerHTML = '<th scope="row">' + count + '</th>' + 
                        '<td>' + movies[movie].Title + '</td>' + 
                        '<td>' + movies[movie].Studio + '</td>' +
                        '<td>' + movies[movie].RecRetPrice + '</td>' +
                        '<td>' + movies[movie].Rating + '</td>' + 
                        '<td>' + movies[movie].Year + '</td>' +
                        '<td>' + movies[movie].Genre + '</td>' +
                        '<td>' + movies[movie].AverageScore + '</td>' +
                        '<td>' + '<button class="btn btn-outline-dark bg-warning btn-xs ratemovie" id="' + movies[movie].Title + 
                            '" type="button" data-toggle="modal" data-target="#modalRateMovie">Rate Movie</button>' + '</td>';
                    tableBody.append(row);
                }

                document.getElementById("resultsTable").style.display = "inline";
            }

            // Sort table by selected heading
            function SortTable(heading) {
                ChangeSortOrder(heading);
                UpdateTable();
            }

            // Clear results table
            function ClearTable() {
                var tableBody = document.getElementById("tableBody");
                tableBody.innerHTML = "";
            }

            // Display alert
            function DisplayAlert(id, classes, message) {
                document.getElementById(id).classList.remove();
                document.getElementById(id).className = classes;
                document.getElementById(id).innerHTML = message;
                document.getElementById(id).style.display = "inline";
            }

		</script>
	</body>
</html>